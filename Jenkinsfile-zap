stage('ZAP Security Scan') {
    node('zap') {
        stage('Scan Web Application') {
            //the checkout is mandatory, otherwise functional test would fail
            echo "checking out source"
            echo "Build: ${BUILD_ID}"
            checkout scm
            dir('zap') {
                def retVal = sh returnStatus: true, script: '/zap/zap-x.sh -last_scan_report /home/jenkins/workspace/moe-gwells-tools-gwells-pipeline-zap/zap/result.xml  -session /home/jenkins/workspace/moe-gwells-tools-gwells-pipeline-zap/zap/TFRS -cmd'
                archiveArtifacts allowEmptyArchive: true, artifacts: '*.xml'
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: '/zap/wrk', reportFiles: 'index.html', reportName: 'ZAP Full Scan', reportTitles: 'ZAP Full Scan'])
                echo "Return value is: ${retVal}"
                }
        }
    }
}
