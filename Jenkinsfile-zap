stage('ZAP Security Scan') {
    node('zap') {
        stage('Scan Web Application') {
            dir('/zap') {
                def retVal = sh returnStatus: true, script: '/zap/zap-full-scan.py -r index.html -x result.xml -t https://testapps.nrs.gov.bc.ca/gwells/'
                junit 'result.xml'
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: true, reportDir: '/zap/wrk', reportFiles: 'index.html', reportName: 'ZAP Full Scan', reportTitles: 'ZAP Full Scan'])
                echo "Return value is: ${retVal}"
            }
        }
    }
}