    stage('Unit Test') {
        node('python') {
            checkout scm
	    sh 'unset BASH_ENV PROMPT_COMMAND ENV && source scl_source enable rh-nodejs6 && source scl_source enable rh-python35'
	    sh 'virtualenv /opt/app-root && source /opt/app-root/bin/activate'
            try {
                sh 'pip install --upgrade pip && pip install -r requirements.txt'
		sh 'cd frontend && npm install && npm run build && cd ..'
		sh 'python manage.py collectstatic && python manage.py migrate'
                sh 'export ENABLE_DATA_ENTRY="True" && python manage.py test -c nose.cfg'
		sh 'cd frontend && npm test && cd ..'
            } 
            finally {
                stash includes: 'nosetests.xml,coverage.xml', name: 'coverage'
                junit 'nosetests.xml'
            }
        }
    }  
